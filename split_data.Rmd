Script to generate data for my papers from phyloseq objects generated in `clean_metabarlists.Rmd`.

```{r}
load("data/cl_metablists_physeq.RData")
```


# Grouping in relevant datasets for papers

ITS and 16s datasets will be analysed separately

## Paper 1 - mother leaves

### Subset

Runs containing mother leaf samples:
  - mother_16s
  - mother_ITS2
  - mother_glom (out, no samples passed pipeline)
  - comp_mother_16s (out, no samples passed pipeline)
```{r}
# First filter non mother leaf samples

sub_mother_16s <- subset_samples(physeqlists$mother_16s, organ == "LEAVES" & project == "HOLOBROM_MERES")
sub_mother_ITS <- subset_samples(physeqlists$mother_ITS2, organ == "LEAVES" & project == "HOLOBROM_MERES")

ntaxa(sub_mother_16s)
ntaxa(sub_mother_ITS)
# Second add trtmt info?

sub_mother_16s %<>% mutate_sample_data(ID = str_extract(sample_id,"^\\d+")) %>%
  mutate_sample_data(trmt = ifelse(ID <16,"DP",
                                   ifelse(between(ID,16,30), "DPS",
                                          ifelse(between(ID,31,45),"DSP",
                                                 ifelse(between(ID,46,60),"WP",
                                                        ifelse(between(ID,61,75), "WSP", "WPS")
                                                 )))))

sub_mother_ITS %<>% mutate_sample_data(ID = str_extract(sample_id,"^\\d+")) %>%
  mutate_sample_data(trmt = ifelse(ID <16,"DP",
                                   ifelse(between(ID,16,30), "DPS",
                                          ifelse(between(ID,31,45),"DSP",
                                                 ifelse(between(ID,46,60),"WP",
                                                        ifelse(between(ID,61,75), "WSP", "WPS")
                                                 )))))
```

### Summarize datasets info

```{r}
ntaxa(sub_mother_16s)
nsamples(sub_mother_16s)
sample_names(sub_mother_16s)

sample_names(sub_mother_ITS)
```







```{r}
# Build PCoA ordinations 
mds1 <- plot_ordination(sub_mother_16s,ordinate(sub_mother_16s,
                                                method = "NMDS",
                                                distance = "bray"),
                        type = "samples",
                        color = "trmt")

# Custom colors
a1 <- mds1 + labs(color = "trtmt") +
  theme(legend.position = "n")+ 
  ggtitle("sub_mother_16s")


# Assemble plots
leg1 <- get_legend(a1 + guides(shape=F) + 
                    theme(legend.position = "right", 
                          legend.direction = "vertical"))
ggdraw() +
  draw_plot(a1, x=0, y=0, width = 0.8, height = 1) + 
  draw_grob(leg1, x=0.4, y=0)

```
```{r}
# Build PCoA ordinations 
mds2 <- plot_ordination(sub_mother_ITS,ordinate(sub_mother_ITS,
                                                method = "NMDS",
                                                distance = "bray"),
                        type = "samples",
                        color = "trmt")

# Custom colors
a2 <- mds2 + labs(color = "trtmt") +
  theme(legend.position = "n") + 
  ggtitle("sub_mother_ITS")


# Assemble plots
leg2 <- get_legend(a2 + guides(shape=F) + 
                    theme(legend.position = "right", 
                          legend.direction = "vertical"))
ggdraw() +
  draw_plot(a2, x=0, y=0, width = 0.8, height = 1) + 
  draw_grob(leg2, x=0.4, y=0)

```


## Paper 2 - mother/seedlings 

Runs containing root and leaf samples:
  - mother_16s
  - mother_ITS2
  - mother_glom
  - comp_mother_16s
  - seedling_ITS2
  - seedling_16s
  
### Mother
```{r}
# Filter out non target samples

sub_mother_16s <- subset_samples(physeqlists$mother_16s, (organ == "LEAVES" | organ == "ROOTS") & project == "HOLOBROM_MERES")
sub_mother_ITS <- subset_samples(physeqlists$mother_ITS2, organ == "LEAVES" | organ == "ROOTS" & project == "HOLOBROM_MERES")

sub_mother_16s %<>% mutate_sample_data(ID = str_extract(sample_id,"^\\d+")) %>%
  mutate_sample_data(trmt = ifelse(ID <16,"DP",
                                   ifelse(between(ID,16,30), "DPS",
                                          ifelse(between(ID,31,45),"DSP",
                                                 ifelse(between(ID,46,60),"WP",
                                                        ifelse(between(ID,61,75), "WSP", "WPS")
                                                 ))))) %>%
  mutate_sample_data(water = ifelse(ID<46,"D","W"))

sub_mother_ITS %<>% mutate_sample_data(ID = str_extract(sample_id,"^\\d+")) %>%
  mutate_sample_data(trmt = ifelse(ID <16,"DP",
                                   ifelse(between(ID,16,30), "DPS",
                                          ifelse(between(ID,31,45),"DSP",
                                                 ifelse(between(ID,46,60),"WP",
                                                        ifelse(between(ID,61,75), "WSP", "WPS")
                                                 ))))) %>%
  mutate_sample_data(water = ifelse(ID<46,"D","W"))

sub_mother_16s <- subset_samples(sub_mother_16s, water == "W")
sub_mother_ITS <- subset_samples(sub_mother_ITS, water == "W")
# Merge different primers
```

```{r}
# Build PCoA ordinations 
mds1 <- plot_ordination(sub_mother_16s,ordinate(sub_mother_16s,
                                                method = "NMDS",
                                                distance = "bray"),
                        type = "samples",
                        color = "trmt",
                        shape = "organ")

# Custom colors
a1 <- mds1 + labs(color = "trtmt",
                  shape = "organ") +
  theme(legend.position = "n")+ 
  ggtitle("sub_mother_16s")


# Assemble plots
leg1 <- get_legend(a1  + 
                    theme(legend.position = "right", 
                          legend.direction = "vertical"))
ggdraw() +
  draw_plot(a1, x=0, y=0, width = 0.8, height = 1) + 
  draw_grob(leg1, x=0.4, y=0)

```

```{r}
# Build PCoA ordinations 
mds2 <- plot_ordination(sub_mother_ITS,ordinate(sub_mother_ITS,
                                                method = "NMDS",
                                                distance = "bray"),
                        type = "samples",
                        color = "trmt",
                        shape = "organ")

# Custom colors
a2 <- mds2 + labs(color = "trtmt",
                  shape = "organ") +
  theme(legend.position = "n")+ 
  ggtitle("sub_mother_ITS")


# Assemble plots
leg2 <- get_legend(a2  + 
                    theme(legend.position = "right", 
                          legend.direction = "vertical"))
ggdraw() +
  draw_plot(a2, x=0, y=0, width = 0.8, height = 1) + 
  draw_grob(leg2, x=0.4, y=0)

```

## Seedling

```{r}
# Filter out non target samples

sub_seedling_16s <- subset_samples(physeqlists$seedling_16s, organ == "LEAVES" | organ =="ROOTS") %>% 
  mutate_sample_data(mo_ID = str_extract(samples,"^\\d+")) %>%
  mutate_sample_data(trmt_mo = ifelse(between(mo_ID,46,60),"WP",
                                   ifelse(between(mo_ID,61,75), "WSP", "WPS")),
                     trtmt = sapply(strsplit(as.character(samples), "_"), function(x) x[[1]][2]),
                     rep = sapply(strsplit(as.character(samples), "_"), function(x) x[[1]][3]))


sub_seedling_ITS <- subset_samples(physeqlists$seedling_ITS2, organ == "LEAVES" | organ =="ROOTS") %>% 
  mutate_sample_data(mo_ID = str_extract(samples,"^\\d+")) %>%
  mutate_sample_data(trmt_mo = ifelse(between(mo_ID,46,60),"WP",
                                   ifelse(between(mo_ID,61,75), "WSP", "WPS")),
                     trtmt = sapply(strsplit(as.character(samples), "_"), function(x) x[[1]][2]),
                     rep = sapply(strsplit(as.character(samples), "_"), function(x) x[[1]][3]))
```

```{r}
# Build PCoA ordinations 
mds1 <- plot_ordination(sub_seedling_16s,ordinate(sub_seedling_16s,
                                                method = "NMDS",
                                                distance = "bray"),
                        type = "samples",
                        color = "trtmt",
                        shape = "organ")

# Custom colors
a1 <- mds1 + labs(color = "trtmt",
                  shape = "organ") +
  theme(legend.position = "n")+ 
  ggtitle("sub_seedling_16s")


# Assemble plots
leg1 <- get_legend(a1  + 
                    theme(legend.position = "right", 
                          legend.direction = "vertical"))
ggdraw() +
  draw_plot(a1, x=0, y=0, width = 0.8, height = 1) + 
  draw_grob(leg1, x=0.4, y=0)

```

```{r}
# Build PCoA ordinations 
mds2 <- plot_ordination(sub_mother_ITS,ordinate(sub_mother_ITS,
                                                method = "NMDS",
                                                distance = "bray"),
                        type = "samples",
                        color = "trmt",
                        shape = "organ")

# Custom colors
a2 <- mds2 + labs(color = "trtmt",
                  shape = "organ") +
  theme(legend.position = "n")+ 
  ggtitle("sub_mother_ITS")


# Assemble plots
leg2 <- get_legend(a2  + 
                    theme(legend.position = "right", 
                          legend.direction = "vertical"))
ggdraw() +
  draw_plot(a2, x=0, y=0, width = 0.8, height = 1) + 
  draw_grob(leg2, x=0.4, y=0)

```

